import{e as k,y as S,b as _,aU as q,z as T,W as O,X as x,J as z,N as j,G as A,v as m,aV as Y,aW as B,x as F,Z as R,aX as V,a9 as G,a4 as W,ad as N,ac as H,a5 as Z,A as J,p as K,D as Q,ae as ee,F as X,aY as te,aZ as ne,a_ as se,av as re,a$ as oe,b0 as ae,b1 as ce,b2 as ie,aT as le}from"./index-AM_KDpRB.js";var ue=A("<div>TODO "),pe=A('<div class="h-32 w-full overflow-x-scroll flex gap-4 pt-4">'),de=A('<button class="aspect-square h-full bg-white border-2 border-ui-bg-500 rounded-xl p-2 flex items-center justify-center text-center">'),fe=A('<img class="block w-full h-full">');function U(e,o,t){const n=e.config?.[e.pattern??h];return n==null||!Object.hasOwn(n,o)?t:n[o]}function _e(e,o,t){return e.config_items?.push({name:o,default_value:t,item:{kind:"boolean"}}),U(e,o,t)}function M(e){return _e(e,"Constant Speed",!1)}const h="gradient",v={gradient:{preview(e,o,t){const n=m.getAngle(m.sub([.5,.5],t.center??[.5,.5]));return P(e,s=>m.rotateRad(s.pos,-n)[1],{total_time:1e3,constant_speed:M(t)})}},random_order:{preview(e,o,t){const n=L(t);for(let s=e.length-1;s>0;s--){const r=Math.floor(n()*(s+1));[e[s],e[r]]=[e[r],e[s]]}return e.flatMap((s,r,c)=>[s.index,{delay_ms:1/c.length*1e3}])}},crazy_random:{preview(e,o,t){return E(e,()=>Math.random()),e.map(n=>n.index)}},sonar:{preview(e,o,t){const n=t.center??[.5,.5];return P(e,r=>Math.atan2(r.pos[1]-n[1],r.pos[0]-n[0]),{total_time:1e3,constant_speed:M(t)})}},expanding_circle:{preview(e,o,t){const n=t.center??[0,0];return P(e,r=>m.distance(r.pos,n),{total_time:1e3,constant_speed:M(t)})}},arrow:{preview(e,o,t){const n=t.center?.[1]??0;return P(e,r=>r.pos[0]+Math.abs(r.pos[1]-n),{total_time:1e3,constant_speed:M(t)})}},rain:{preview(e,o,t){const n=L(t),s=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]];for(const c of e){const l=Math.floor(c.pos[0]*s.length);s[l].push(c)}E(s,n);for(const c of s)c.sort((l,a)=>l.pos[1]-a.pos[1]);return s.flat().flatMap((c,l,a)=>[c.index,{delay_ms:1/a.length*1e3}])}},wave:{preview:(e,o)=>w(e,o,t=>[t,(Math.sin(2*Math.PI*t)+1)/2])},spiral:{preview:(e,o)=>w(e,o,t=>{const r=16*Math.PI,c=0+(.5-0)*t,l=r*t,a=[.5,.5];return m.add(a,m.mul([c,c],[Math.cos(l),Math.sin(l)]))})},lissajous_curve:{preview(e,o,t){const l=Math.PI/4;return w(e,o,a=>{const i=.5+.5*Math.sin(2*Math.PI*5*a+l),u=.5+.5*Math.sin(2*Math.PI*4*a);return[i,u]})}},heart_curve:{preview(e,o,t){return w(e,o,n=>{const s=n*2*Math.PI,r=16*Math.pow(Math.sin(s),3),c=13*Math.cos(s)-5*Math.cos(2*s)-2*Math.cos(3*s)-Math.cos(4*s),l=.5+r/35,a=.5-c/35;return[l,a]})}},archimedean_spiral:{preview(e,o,t){return w(e,o,n=>{const s=8*Math.PI,r=n*s,c=0,l=.1,a=c+l*r,i=.5/(c+l*s),u=.5+a*Math.cos(r)*i,p=.5+a*Math.sin(r)*i;return[u,p]})}},harmonograph:{preview(e,o,t){const l=Math.PI/4,a=3,i=.012,u=.5,p=Math.PI/3;return w(e,o,f=>{const d=f*20,I=.5+.5*Math.sin(2*d+l)*Math.exp(-.01*d),y=.5+u*Math.sin(a*d+p)*Math.exp(-i*d);return[I,y]},{duration:4e3})}},voronoi:{preview(e,o,t){const n=L(t),s=10,r=new Array(s).fill(0).map((a,i)=>{const u=[n(),n()];return i===0&&t.center!=null&&t.mouse?t.center:u}),c=new Array(s).fill(0).map(()=>[]);for(const a of e){let i=1/0,u=-1;for(let p=0;p<r.length;p++){const f=r[p],d=m.distance(a.pos,f);d<i&&(i=d,u=p)}c[u].push(a)}for(let a=0;a<c.length;a++){const i=r[a];c[a].sort((p,f)=>m.distance(p.pos,i)-m.distance(f.pos,i))}const l=[];for(const a of c){for(const i of a)l.push(i.index);l.push({delay_ms:1e3/s})}return l}}};function L(e){return Y(...B(""+(e.random_seed??0)))}function E(e,o){for(let t=0;t<e.length;t++){const n=Math.floor(o()*(e.length-t))+t,s=e[n];e[n]=e[t],e[t]=s}}function P(e,o,t){const n=e.map(i=>[i.index,o(i)]),s=n.reduce((i,u)=>Math.min(i,u[1]),1/0),r=n.reduce((i,u)=>Math.max(i,u[1]),-1/0),c=n.sort((i,u)=>i[1]-u[1]),l=[];let a;for(const i of c)if(l.push(i[0]),t.constant_speed){const u=(i[1]+s)/(r-s)*t.total_time;a!=null&&l.push({delay_ms:u-a}),a=u}else l.push({delay_ms:t.total_time/c.length});return l}function me(e,o,t){let n=e.settings.on_duration_ms*e.settings.pattern_speed_multiplier;n=Math.max(.01,n);const s=t?.duration??1e3;let r=0;for(let c=0;c<s;c+=n){if(r+=1,r>1e4){console.warn("iteration too long");break}o(c/s,n)}}function w(e,o,t,n){const s=l=>{let a=null;for(const i of e){const u=m.distance(l,i.pos);(a==null||u<a[1])&&(a=[i.index,u])}return a?.[0]??null};let r=[],c=null;return me(o,(l,a)=>{const i=s(t(l));i!=null&&i!==c&&(r.push(i),c=i),r.push({delay_ms:a})},n),r}function he(e,o,t){const n=e.modes.pattern;if(e.play&&n.pattern===t){e.play=!1,o();return}n.pattern=t,$(e,o)}function $(e,o){e.modes.pattern,e.play=!1,o(),e.play=!0,o()}function D(e){return e.split("_").map(o=>o.replaceAll(/\b[a-z]/g,t=>t.toUpperCase())).join(" ")}function ge(e){const{state:o,setState:t}=k(R),n=()=>o().modes.pattern,{item:s,default_value:r,name:c}=e.item,l=S(()=>U(n(),c,r)),a=i=>{((n().config??={})[n().pattern??h]??={})[c]=i,t()};return s.kind==="boolean"?_(le,{label:c,get value(){return l()},setValue:a}):(()=>{var i=ue();return i.firstChild,T(i,()=>e.item.item.kind,null),i})()}function ve(e){return _(X,{get each(){return e.items},children:o=>_(ge,{item:o})})}const b=new OffscreenCanvas(5,5),ye=new OffscreenCanvas(1,1),C=ye.getContext("2d");let g;async function we(e,o){g!=null&&await new Promise(t=>g.push(t)),g==null&&(g=[]);try{return await be(e,o)}finally{if(g!=null){const t=g.shift();g.length===0&&(g=[]),t?.()}}}async function be(e,o){b.width!==77&&(b.width=77),b.height!==77&&(b.height=77);const s=new te(C,b);C.save();const r=new ne(se([10,10],"zig")),c=re([[0,0],[77,77]],r.bounds[0]/r.bounds[1]),l=oe(c,r.bounds);s.transform(l);const a=[];for(let d=0;d<r.max_pts;d++){const I=r.ptCenter(d),y=ae(r.define_rect_scaler,I);y[0]<0||y[1]<0||y[0]>1||y[1]>1||a.push({pos:y,index:d})}const i=[],u=v[o]?.preview?.(a,{settings:{on_duration_ms:1,pattern_speed_multiplier:1}},{center:[.5,.5],mouse:!1,config_items:i});if(u==null)return"";(e.config_items_by_pattern??={})[o]=i,ce(s,{scale:1},{force_fast_render:!1,noise_on_preview:!1,state_play:!1,grid:r,grayscale:!1,use_rst_new:!0},ie(u,{frame_index:0},{preview_mode_opacity:1}),{force_fast:!1,grid_path:{stroke:[0,0,0,0],fill:[0,0,0,0]}}),C.restore();const p=await b.convertToBlob();return URL.createObjectURL(p)}const Me={sidePanel(){const{state:e,setState:o}=k(R),t=()=>e().modes.pattern,n=S(()=>t().pattern??h),s=S(()=>{const r=t();return r.config_items_by_pattern?.[r.pattern??h]??void 0});return _(W,{collapsible:"Pattern",get children(){return[_(V,{label:"Pattern",get choices(){return Object.keys(v).map(r=>[r,D(r)])},get value(){return n()},setValue:r=>{t().pattern=r??h,o()},names:{none:"",empty_list:""},hide_null_choice:!0}),_(ve,{get items(){return s()??[]}}),_(G,{})]}})},dockPanel(){const{state:e,setState:o}=k(R),t=()=>e().modes.pattern;return q(()=>t().pattern),_(H,{vertical:!0,get children(){return _(N,{get dr_tools_active(){return t().tool==="define_rect"},setDrToolsActive:n=>{n?t().tool="define_rect":t().tool=void 0,o()}})}})},topPanel(){const{state:e,setState:o}=k(R),t=()=>e().modes.pattern;return(()=>{var n=pe();return T(n,_(X,{get each(){return Object.keys(v)},children:s=>{const r=()=>v[s]?.preview_icon??null;let c=null;const l=a=>{c!=null&&document.body.removeEventListener("mouseup",c,{capture:!0}),c=a,c!=null&&document.body.addEventListener("mouseup",c,{capture:!0})};return(()=>{var a=de();return a.addEventListener("mouseleave",()=>{t().hover_pattern=void 0,o()}),a.addEventListener("mouseenter",()=>{t().hover_pattern!==s&&(t().hover_pattern=s),o()}),a.$$click=()=>{c||(!e().play||t().pattern!==s)&&(t().pattern=s,$(e(),o))},a.$$mousedown=i=>{e().repeat=!0,he(e(),o,s),l(u=>{l(null),e().repeat&&(e().repeat=!1,o());const p=f=>{f.stopPropagation(),f.stopImmediatePropagation(),document.body.removeEventListener("click",p,{capture:!0})};document.body.addEventListener("click",p,{capture:!0})})},T(a,_(Z,{get when(){return r()},get fallback(){return(()=>{var i=fe();return J(u=>{let p=null,f=!1;K(()=>{f=!0,p!=null&&URL.revokeObjectURL(p)}),we(t(),s).then(d=>{if(f){URL.revokeObjectURL(d);return}p=d,u.src=d})},i),Q(()=>ee(i,"title",D(s))),i})()},children:i=>i})),a})()}})),n})()},render({state:e,imev:o,frame:t}){const n=e.modes.pattern;if(n.tool==null){let s=function(r){const c=r!=null?O(t,r):null,l=c!=null?x(e.define_rect,t,c):[.5,.5];n.center=l,n.mouse=r!=null};n.mouse_held||s(o.mouse.pos),o.mouse.action={cursor:"default",callback:(r,c)=>{n.mouse_held=!0;const l=O(t,r);if(n.tool==null){const a=x(e.define_rect,t,l);n.center=a,n.mouse=!0,e.repeat=!0,$(e,c.setstate)}return s(r),{onmove(a){s(a)},onrelease(a){n.mouse_held=!1,s(a),e.repeat&&(e.repeat=!1,c.setstate())}}}}}z(e,t,o,{enable_resize:n.tool==="define_rect"})},previewer:function(e){const o=e.modes.pattern,t=v[o.hover_pattern??o.pattern??h]??v[h];if(t==null)return[];const n=j(e),s=[];for(let r=0;r<n.max_pts;r++){const c=n.ptCenter(r),l=x(e.define_rect,{grid:n},c);l[0]<0||l[1]<0||l[0]>1||l[1]>1||s.push({pos:l,index:r})}return t.preview?.(s,e,o)??[]},sequencer:function*(e,o){const t=e.modes.pattern,n=v[t.pattern??h]??v[h];if(n==null)return;const s=j(e),r=[];for(let c=0;c<s.max_pts;c++){const l=s.ptCenter(c),a=x(e.define_rect,{grid:s},l);a[0]<0||a[1]<0||a[0]>1||a[1]>1||r.push({pos:a,index:c})}n.sequence!=null?yield*n.sequence(r,e,t):(yield n.preview?.(r,e,t)??[],yield{delay:0}),t.random_seed??=0,t.random_seed+=1}};F(["mousedown","click"]);export{Me as default};
