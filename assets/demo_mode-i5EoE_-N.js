import{aI as K,b5 as Q,a$ as k,b6 as E,b7 as z,av as U,aL as Y,b8 as G,b9 as Z,v as n,N as ee,ba as te,bb as re,bc as se}from"./index-AM_KDpRB.js";import{u as oe,d as C}from"./objd_worker_manager-lQi2Vwar.js";const ne="/app-dev/assets/live_preview_hand-EyeVukRw.png";let F=document.createElement("img");F.src=ne;function de(s,N,f,P){const{rh:e}=f,r=K(),T=P.target_rect,O=Q(T),X=k(O,[E,z]),i=[r?.videoWidth??100,r?.videoHeight??100],B=U(T,i[0]/i[1]);let o=k(B,i);Y()&&(o=o.translate(i[0],0),o=o.flipX());const L=G(s,o,"fullscreen",f.frame_index);if(o.is2D){if(e.save(),e.setTransform(e.getTransform().multiply(o)),e.save(),Z(e,[0,0],i,L),e.clip(),r!=null){oe(s,r),e.save(),f.ctx.drawImage(r,0,0),e.restore();let x=null,u=!1,y=0;const a=C.hands[0];if(a!=null){C.handedness[0],e.save();const S=[[2,3,4],[6,7,8],[10,11,12],[14,15,16],[18,19,20]],V=[[0,1,2],[0,5,6],[9,10],[13,14],[0,17,18],[5,9,13,17]],l=c=>[c.x*r.videoWidth,c.y*r.videoHeight];if(e.lineWidth=2,e.strokeStyle="#2955f4",s.settings.show_bounding_boxes){for(const c of S)for(const[b,v]of c.entries()){const _=l(a[v]);b==0?e.moveTo(..._):e.lineTo(..._)}e.stroke();for(const c of V)for(const[b,v]of c.entries()){const _=l(a[v]);b==0?e.moveTo(..._):e.lineTo(..._)}e.globalAlpha=.2,e.stroke(),e.globalAlpha=1}const d=l(a[5]),w=l(a[17]),H=l(a[0]),I=n.sub(w,d),A=n.add(d,n.div(I,[2,2])),$=n.sub(H,A),g=n.getAngle($)+Math.PI,D=n.rotateRad(I,-g),j=n.distance(d,w),q=n.distance(A,H),m=ee(s).bounds,M=.15,R=.15,h=[m[0]*(1-.15-M),m[1]*(1-0-R)];let t=new DOMMatrixReadOnly;t=t.translate(d[0],d[1]),t=t.rotate(te(g)),D[0]<0&&(t=t.flipX()),t=t.scale(j/h[0],q/h[1]),t=t.translate(-m[0]*M,-m[1]*R);const J=o.multiply(t);e.setTransform(e.getTransform().multiply(t));const p=G(s,J,"fullscreen",f.frame_index);re(e,s,p,{force_fast:!0,grid_path:{stroke:[41/255,85/255,244/255,p.scale<1?p.scale:1],fill:[1,1,1,1]}}),e.restore();const W=t.transformPoint({x:h[0]/2,y:h[1]/2});x=[W.x,W.y],D[0]<0&&(u=!0),y=g}se(u),s.active_mode?.mode.renderCamera?.({state:s,setState:N,ctx:e,size:[r.videoWidth,r.videoHeight],hand_center:x,hand_mirrored:u,hand_rotation:y})}e.restore(),e.restore(),e.save(),e.setTransform(e.getTransform().multiply(X)),e.drawImage(F,0,0,E,z),e.restore()}}export{de as renderDemoMode};
