import{u as Me,a as ye,b as y,m as Ae,M as Ke,d as Re,e as G,g as Ze,h as Je,i as Oe,j as J,k as et,n as tt,o as nt,p as ge,P as rt,q as st,r as te,t as ot,w as at,x as Te,y as R,z as $,A as de,B as re,C as lt,D as Z,E as pe,F as Be,G as B,H as ce,I as it,J as ct,v as I,K as ut,L as dt,N as pt,O as ft,Q as _t,R as V,S as ae,T as ht,U as gt,V as K,W as H,X as ue,Y as vt,Z as se,_ as mt,$ as xe,a0 as xt,a1 as me,a2 as Ce,a3 as bt,a4 as ke,a5 as wt,a6 as X,a7 as yt,a8 as At,a9 as Ct,aa as kt,ab as Pt,ac as Pe,ad as St,ae as ee,af as It,ag as Lt,ah as Dt,ai as Et,aj as $t,ak as Mt,al as Rt,am as Ot,an as Fe,ao as Tt,ap as be,aq as we,ar as Bt,as as Ft,at as qe,au as qt,av as Ut}from"./index-AM_KDpRB.js";import{r as zt}from"./render_shape-X8fT00Gq.js";function jt(e){const r=Me(),[n,t]=ye(e,["onCloseAutoFocus","onInteractOutside"]);let u=!1;return y(Ke,Ae({onCloseAutoFocus:p=>{n.onCloseAutoFocus?.(p),!p.defaultPrevented&&u&&p.preventDefault(),u=!1},onInteractOutside:p=>{n.onInteractOutside?.(p),!p.defaultPrevented&&!r.isModal()&&(u=!0)}},t))}const Ue=Re();function Nt(){return G(Ue)}function Wt(){const e=Nt();if(e===void 0)throw new Error("[kobalte]: `useContextMenuContext` must be used within a `ContextMenu` component");return e}function Yt(e){const r=`contextmenu-${Ze()}`,{direction:n}=Je();e=Oe({id:r,placement:n()==="rtl"?"left-start":"right-start",gutter:2,shift:2},e);const[t,u]=ye(e,["onOpenChange"]),[_,A]=J({x:0,y:0}),p=et({defaultOpen:!1,onOpenChange:x=>t.onOpenChange?.(x)}),h={setAnchorRect:A};return y(Ue.Provider,{value:h,get children(){return y(tt,Ae({get open(){return p.isOpen()},get onOpenChange(){return p.setIsOpen},getAnchorRect:_},u))}})}function Vt(e){const r=Me(),n=nt(),t=Wt();e=Oe({id:r.generateId("trigger")},e);const[u,_]=ye(e,["ref","style","disabled","onContextMenu","onPointerDown","onPointerMove","onPointerCancel","onPointerUp"]);let A=0;const p=()=>{window.clearTimeout(A)};ge(()=>{p()});const h=b=>{if(u.disabled){te(b,u.onContextMenu);return}p(),b.preventDefault(),t.setAnchorRect({x:b.clientX,y:b.clientY}),n.isOpen()?n.focusContent():n.open(!0)},x=b=>b.pointerType==="touch"||b.pointerType==="pen";return y(rt,Ae({as:"div",ref(b){var l=st(n.setTriggerRef,u.ref);typeof l=="function"&&l(b)},get style(){return{"-webkit-touch-callout":"none",...u.style}},get"data-disabled"(){return u.disabled?"":void 0},onContextMenu:h,onPointerDown:b=>{te(b,u.onPointerDown),!u.disabled&&x(b)&&(p(),A=window.setTimeout(()=>n.open(!1),700))},onPointerMove:b=>{te(b,u.onPointerMove),!u.disabled&&x(b)&&p()},onPointerCancel:b=>{te(b,u.onPointerCancel),!u.disabled&&x(b)&&p()},onPointerUp:b=>{te(b,u.onPointerUp),!u.disabled&&x(b)&&p()}},()=>n.dataset(),_))}var ze={exports:{}};(function(e,r){(function(n,t){t(e)})(ot,function(n){function t(s,d){if(!(s instanceof d))throw new TypeError("Cannot call a class as a function")}/**
 *  @preserve  JavaScript implementation of
 *  Algorithm for Automatically Fitting Digitized Curves
 *  by Philip J. Schneider
 *  "Graphics Gems", Academic Press, 1990
 *
 *  The MIT License (MIT)
 *
 *  https://github.com/soswow/fit-curves
 */function u(s,d,o){if(!Array.isArray(s))throw new TypeError("First argument should be an array");if(s.forEach(function(g){if(!Array.isArray(g)||g.some(function(m){return typeof m!="number"})||g.length!==s[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")}),s=s.filter(function(g,m){return m===0||!g.every(function(k,P){return k===s[m-1][P]})}),s.length<2)return[];var i=s.length,c=b(s[1],s[0]),v=b(s[i-2],s[i-1]);return _(s,c,v,d,o)}function _(s,d,o,i,c){var v=20,g,m,k,P,L,S,O,T,W,Y,M,F,j;if(s.length===2)return F=l.vectorLen(l.subtract(s[0],s[1]))/3,g=[s[0],l.addArrays(s[0],l.mulItems(d,F)),l.addArrays(s[1],l.mulItems(o,F)),s[1]],[g];m=a(s);var q=A(s,m,m,d,o,c);if(g=q[0],P=q[1],S=q[2],P===0||P<i)return[g];if(P<i*i)for(k=m,L=P,O=S,j=0;j<v;j++){k=h(g,s,k);var U=A(s,m,k,d,o,c);if(g=U[0],P=U[1],S=U[2],P<i)return[g];if(S===O){var N=P/L;if(N>.9999&&N<1.0001)break}L=P,O=S}if(M=[],T=l.subtract(s[S-1],s[S+1]),T.every(function(ve){return ve===0})){T=l.subtract(s[S-1],s[S]);var z=[-T[1],T[0]];T[0]=z[0],T[1]=z[1]}return W=l.normalize(T),Y=l.mulItems(W,-1),M=M.concat(_(s.slice(0,S+1),d,W,i,c)),M=M.concat(_(s.slice(S),Y,o,i,c)),M}function A(s,d,o,i,c,v){var g,m,k;g=p(s,o,i,c);var P=f(s,g,d);return m=P[0],k=P[1],v&&v({bez:g,points:s,params:d,maxErr:m,maxPoint:k}),[g,m,k]}function p(s,d,o,i){var c,v,g,m,k,P,L,S,O,T,W,Y,M,F,j,q,U,N=s[0],z=s[s.length-1];for(c=[N,null,null,z],v=l.zeros_Xx2x2(d.length),M=0,F=d.length;M<F;M++)q=d[M],U=1-q,g=v[M],g[0]=l.mulItems(o,3*q*(U*U)),g[1]=l.mulItems(i,3*U*(q*q));for(m=[[0,0],[0,0]],k=[0,0],M=0,F=s.length;M<F;M++)q=d[M],g=v[M],m[0][0]+=l.dot(g[0],g[0]),m[0][1]+=l.dot(g[0],g[1]),m[1][0]+=l.dot(g[0],g[1]),m[1][1]+=l.dot(g[1],g[1]),j=l.subtract(s[M],w.q([N,N,z,z],q)),k[0]+=l.dot(g[0],j),k[1]+=l.dot(g[1],j);return P=m[0][0]*m[1][1]-m[1][0]*m[0][1],L=m[0][0]*k[1]-m[1][0]*k[0],S=k[0]*m[1][1]-k[1]*m[0][1],O=P===0?0:S/P,T=P===0?0:L/P,Y=l.vectorLen(l.subtract(N,z)),W=1e-6*Y,O<W||T<W?(c[1]=l.addArrays(N,l.mulItems(o,Y/3)),c[2]=l.addArrays(z,l.mulItems(i,Y/3))):(c[1]=l.addArrays(N,l.mulItems(o,O)),c[2]=l.addArrays(z,l.mulItems(i,T))),c}function h(s,d,o){return o.map(function(i,c){return x(s,d[c],i)})}function x(s,d,o){var i=l.subtract(w.q(s,o),d),c=w.qprime(s,o),v=l.mulMatrix(i,c),g=l.sum(l.squareItems(c))+2*l.mulMatrix(i,w.qprimeprime(s,o));return g===0?o:o-v/g}function a(s){var d=[],o,i,c;return s.forEach(function(v,g){o=g?i+l.vectorLen(l.subtract(v,c)):0,d.push(o),i=o,c=v}),d=d.map(function(v){return v/i}),d}function f(s,d,o){var i,c,v,g,m,k,P,L;c=0,v=Math.floor(s.length/2);var S=C(d,10);for(m=0,k=s.length;m<k;m++)P=s[m],L=D(d,o[m],S,10),g=l.subtract(w.q(d,L),P),i=g[0]*g[0]+g[1]*g[1],i>c&&(c=i,v=m);return[c,v]}var C=function(d,o){for(var i,c=[0],v=d[0],g=0,m=1;m<=o;m++)i=w.q(d,m/o),g+=l.vectorLen(l.subtract(i,v)),c.push(g),v=i;return c=c.map(function(k){return k/g}),c};function D(s,d,o,i){if(d<0)return 0;if(d>1)return 1;for(var c,v,g,m,k,P=1;P<=i;P++)if(d<=o[P]){m=(P-1)/i,g=P/i,v=o[P-1],c=o[P],k=(d-v)/(c-v)*(g-m)+m;break}return k}function b(s,d){return l.normalize(l.subtract(s,d))}var l=function(){function s(){t(this,s)}return s.zeros_Xx2x2=function(o){for(var i=[];o--;)i.push([0,0]);return i},s.mulItems=function(o,i){return o.map(function(c){return c*i})},s.mulMatrix=function(o,i){return o.reduce(function(c,v,g){return c+v*i[g]},0)},s.subtract=function(o,i){return o.map(function(c,v){return c-i[v]})},s.addArrays=function(o,i){return o.map(function(c,v){return c+i[v]})},s.addItems=function(o,i){return o.map(function(c){return c+i})},s.sum=function(o){return o.reduce(function(i,c){return i+c})},s.dot=function(o,i){return s.mulMatrix(o,i)},s.vectorLen=function(o){return Math.hypot.apply(Math,o)},s.divItems=function(o,i){return o.map(function(c){return c/i})},s.squareItems=function(o){return o.map(function(i){return i*i})},s.normalize=function(o){return this.divItems(o,this.vectorLen(o))},s}(),w=function(){function s(){t(this,s)}return s.q=function(o,i){var c=1-i,v=l.mulItems(o[0],c*c*c),g=l.mulItems(o[1],3*c*c*i),m=l.mulItems(o[2],3*c*i*i),k=l.mulItems(o[3],i*i*i);return l.addArrays(l.addArrays(v,g),l.addArrays(m,k))},s.qprime=function(o,i){var c=1-i,v=l.mulItems(l.subtract(o[1],o[0]),3*c*c),g=l.mulItems(l.subtract(o[2],o[1]),6*c*i),m=l.mulItems(l.subtract(o[3],o[2]),3*i*i);return l.addArrays(l.addArrays(v,g),m)},s.qprimeprime=function(o,i){return l.addArrays(l.mulItems(l.addArrays(l.subtract(o[2],l.mulItems(o[1],2)),o[0]),6*(1-i)),l.mulItems(l.addArrays(l.subtract(o[3],l.mulItems(o[2],2)),o[1]),6*i))},s}();n.exports=u,n.exports.fitCubic=_,n.exports.createTangent=b})})(ze);var Xt=ze.exports;const Ht=at(Xt),Qt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAQCAYAAADwMZRfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAEaSURBVHgBlZLNEYIwEIUz6sFj7CAlUEKO3rAESqAD6IB0QDrg6JESoAO0gtBBzMZdJsQIw5t5Q2DZj/3hzBgrnZ/Od+eb89X5xQ7oglfuLNGkEWHgd3AeUyBItGQppTfn3IbPA1fsjwy9BMnDMFiQMcb2fW+7rrNN09gsywjEU5AegvBiDAqllCJInYIoCMJX27ZdQEVRWK31AoHKsE2TghSQSAlUERmSSWVZ0nNJySe8+omP43fwbrCrL8zzvJzzPKfjz4AF0KF8UlVVfpBQVSwccLIlH9xTXdfUzpSCTEKIVf87gIx9//bVuv2GaCvxihOAAe8fIYQjecKgbw82tgHQbENA79j6dz8ECCWwOoXnw4BYHKvRceADWFo2KYwnXVIAAAAASUVORK5CYII=",Gt="data:image/svg+xml,%3csvg%20width='17'%20height='16'%20viewBox='0%200%2017%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3.22351%2011.1303L1.48438%201.21729L11.7452%202.7825L14.18%209.04337L9.31046%2013.739L3.22351%2011.1303Z'%20fill='white'/%3e%3cpath%20d='M14.89%208.06462C15.0078%208.35943%2015.0433%208.68071%2014.9926%208.99412C14.942%209.30753%2014.8072%209.60131%2014.6025%209.84405L14.5018%209.95445L10.3624%2014.0933C10.1378%2014.3181%209.85635%2014.4776%209.54812%2014.5547C9.23989%2014.6319%208.91648%2014.6238%208.61249%2014.5314L8.47228%2014.4814L3.291%2012.4094C3.0009%2012.2932%202.74717%2012.1016%202.55611%2011.8543C2.36506%2011.607%202.24364%2011.3132%202.20445%2011.0032L1.64803%206.55329C1.63488%206.43939%201.61824%206.31849%201.59896%206.19408L1.53587%205.80507L1.49907%205.60181L1.37639%204.96836L1.28351%204.53468L1.13717%203.88196L0.937387%203.04525L0.590391%201.68549L0.437923%201.1195C0.398644%200.976672%200.395856%200.826266%200.429812%200.682077C0.463769%200.537887%200.533384%200.404528%200.632276%200.294227C0.731168%200.183926%200.856173%200.100212%200.995827%200.0507618C1.13548%200.00131114%201.28532%20-0.0122939%201.43159%200.0111938L1.55953%200.0409823L2.53392%200.299442L3.45223%200.530742L4.28905%200.7305L4.94186%200.876815L5.37648%200.968809L6.00914%201.09234L6.40959%201.16243L6.78462%201.21851L11.4112%201.79676C11.6968%201.8331%2011.969%201.93926%2012.2037%202.10582C12.4385%202.27239%2012.6286%202.49424%2012.7572%202.75174L12.8176%202.88404L14.89%208.06462ZM13.2628%208.71471L11.1904%203.53501L7.09657%203.02334L6.74957%202.98129C6.10494%202.89541%205.46414%202.78287%204.82883%202.64398L4.14009%202.49416L7.02121%205.37489C7.39386%205.27502%207.78905%205.30089%208.14549%205.44848C8.50193%205.59608%208.7997%205.85715%208.99262%206.19121C9.18553%206.52527%209.26281%206.91364%209.21246%207.29609C9.16211%207.67854%208.98695%208.03369%208.71415%208.30645C8.44135%208.57922%208.08615%208.75435%207.70365%208.8047C7.32115%208.85504%206.93272%208.77777%206.59862%208.58488C6.26452%208.39199%206.00341%208.09426%205.85579%207.73787C5.70818%207.38148%205.6823%206.98634%205.78219%206.61374L2.90107%203.73301L2.9773%204.07646L3.12189%204.76335C3.20954%205.19138%203.28551%205.62172%203.34971%206.05389L3.94206%2010.7824L9.12246%2012.8544L13.2628%208.71471ZM16.1491%2010.785C16.3001%2010.9358%2016.3909%2011.1364%2016.4045%2011.3494C16.418%2011.5623%2016.3534%2011.7728%2016.2227%2011.9415L16.1491%2012.0239L12.4321%2015.7404C12.2747%2015.8992%2012.0627%2015.9919%2011.8392%2015.9995C11.6158%2016.0071%2011.3979%2015.929%2011.2302%2015.7812C11.0625%2015.6334%2010.9576%2015.4271%2010.937%2015.2046C10.9164%2014.982%2010.9817%2014.76%2011.1194%2014.5839L11.193%2014.5016L14.9101%2010.785C15.0744%2010.6208%2015.2973%2010.5285%2015.5296%2010.5285C15.762%2010.5285%2015.9848%2010.6208%2016.1491%2010.785Z'%20fill='black'/%3e%3c/svg%3e";var Kt=B("<div>"),Zt=B("<div><div>"),Jt=B("<button>");const fe=Symbol();function en(e){return e!=null&&typeof e=="object"&&fe in e}function tn(e){const r=Symbol(),[n,t]=J(null,{equals:(h,x)=>!h||!x?h===x:h.item===x.item&&h.hovering===x.hovering&&h.height===x.height&&h.margin_top===x.margin_top&&h.margin_bottom===x.margin_bottom}),u=R(()=>n()!=null),[_,A]=J(0);let p;return(()=>{var h=Kt(),x=p;return typeof x=="function"?de(x,h):p=h,$(h,y(Be,{get each(){return e.items},children:(a,f)=>{let C,D;const[b,l]=J(null),w=R(()=>b()!=null);return ge(()=>{D?.()}),(()=>{var s=Zt(),d=s.firstChild;return de(o=>{C=o,re(()=>o[fe]={owner:r,index:f()}),re(()=>{const i=b();o.style.zIndex=i?"1":"",o.style.position=i?"relative":""})},s),de(o=>{re(()=>{o.style.pointerEvents=n()?"none":""});let i=null,c=!1;o.style.transformOrigin="top",re(()=>{c&&(e.disable_clip_path||(o.style.clipPath="inset(0 0 0 0)"));const v=_();if(v===1||v===3){o.style.transform!==""||v===3?(i=o.getBoundingClientRect(),o.style.transition="",o.style.transform=""):(i=null,o.style.transition="");return}else if(v===2){if(i){const P=o.getBoundingClientRect(),L=i.x-P.x,S=i.y-P.y,O=P.width-i.width,T=P.height-i.height;o.style.transition="",e.disable_clip_path||(o.style.clipPath="inset(0 0 "+T+"px "+O+"px)"),c=!0,o.style.transform=["translate("+L+"px, "+S+"px)"].join(" "),i=null,o.offsetHeight,o.style.transition="0.2s transform ease-out, 0.2s clip-path ease-out"}return}const g=b();if(g){o.style.transition="",o.style.transform="translate("+g.x+"px, "+g.y+"px)";return}o.style.transition="0.2s transform, 0.2s clip-path";const m=n();if(!m){o.style.transform="";return}const k=f();if(m.item>k){if(m.hovering<=k){o.style.transform="translateY("+m.height+"px)";return}}else if(m.hovering>=k){o.style.transform="translateY(-"+m.height+"px)";return}o.style.transform=""})},d),$(d,y(je.Provider,{value:{selfIsDragging:w,dragging:n,setDragging:t,get wrapper_el(){return C},get container_el(){return p},index:f,selfDragging:b,setSelfDragging:l,list_symbol:r,flipState:_,setFlipState:A,setItems:o=>e.setItems(o),set cleanFn(o){D=o},get cleanFn(){return D}},get children(){return lt(()=>e.children(a,w,f,u))}})),Z(o=>{var i=e.wrapper_class,c=e.nodeClass(w);return i!==o.e&&pe(s,o.e=i),c!==o.t&&pe(d,o.t=c),o},{e:void 0,t:void 0}),s})()}})),Z(a=>{var f=(n()?.margin_top??0)+"px",C=(n()?.margin_bottom??0)+"px";return f!==a.e&&((a.e=f)!=null?h.style.setProperty("padding-top",f):h.style.removeProperty("padding-top")),C!==a.t&&((a.t=C)!=null?h.style.setProperty("padding-bottom",C):h.style.removeProperty("padding-bottom")),a},{e:void 0,t:void 0}),h})()}const je=Re();function Se(e,r,n){return(e-r[0])/r[1]*n[1]+n[0]}function nn(e){const r=G(je);if(!r)throw new Error("dragbutton used outside of draggable");return(()=>{var n=Jt();return n.$$pointerdown=t=>{if(!t.isPrimary||r.dragging())return;t.preventDefault();const u=c=>{const v=r.wrapper_el.getBoundingClientRect();r.setDragging({item:r.index(),hovering:c,height:v.height,margin_top:a,margin_bottom:f})};r.setSelfDragging({x:0,y:0});const _=t.pageX,A=t.pageY,p=r.container_el.getBoundingClientRect(),h=r.wrapper_el.getBoundingClientRect(),x=p.height;let a=0,f=x;r.setFlipState(3),u(r.index());const C=r.container_el.getBoundingClientRect(),D=r.wrapper_el.getBoundingClientRect(),b=t.clientY-h.top,l=Se(b,[0,h.height],[0,D.height]);a=h.top-D.top+(b-l),f=p.height-(C.height-x)-a,u(r.index()),r.setFlipState(2),r.setFlipState(0);const w=c=>{const v=c.pageX-_,g=c.pageY-A;r.setSelfDragging({x:v,y:g});const m=document.elementFromPoint(c.clientX,c.clientY);en(m)&&m[fe].owner===r.list_symbol?u(m[fe].index):u(r.index())},s=c=>ce(()=>{c.isPrimary&&(c.preventDefault(),c.stopImmediatePropagation(),w(c))}),d=c=>{if(!c.isPrimary)return;c.preventDefault(),c.stopImmediatePropagation(),w(c);const v=r.dragging(),g=r.index();if(v){r.setFlipState(3);const m=v.hovering;r.setItems(O=>{const T=[...O],W=T.splice(g,1);return T.splice(m,0,...W),T});const k=r.wrapper_el.getBoundingClientRect(),P=c.clientY-k.top;r.setDragging(null);const L=r.wrapper_el.getBoundingClientRect(),S=Se(P,[0,k.height],[0,L.height]);document.documentElement.scrollTop-=k.top-L.top+(P-S),r.setFlipState(2)}ce(()=>{r.setFlipState(0),i()})},o=c=>{c.isPrimary&&(c.preventDefault(),c.stopImmediatePropagation(),ce(()=>i()))};document.addEventListener("pointermove",s,{capture:!0}),document.addEventListener("pointerup",d,{capture:!0}),document.addEventListener("pointercancel",o,{capture:!0});const i=()=>ce(()=>{r.cleanFn=void 0,r.setDragging(null),r.setSelfDragging(null),document.removeEventListener("pointermove",s,{capture:!0}),document.removeEventListener("pointerup",d,{capture:!0}),document.removeEventListener("pointercancel",o,{capture:!0})});if(r.cleanFn)throw new Error("attempt to double register fn");r.cleanFn=i},n.$$keydown=t=>{if(r.dragging())return;const u=r.index();t.code==="ArrowUp"?(t.preventDefault(),t.stopPropagation(),r.setItems(_=>{const A=Math.max(u-1,0),p=[..._],h=p.splice(u,1);return p.splice(A,0,...h),p}),t.currentTarget.focus()):t.code==="ArrowDown"&&(t.preventDefault(),t.stopPropagation(),r.setItems(_=>{const A=Math.min(u+1,_.length),p=[..._],h=p.splice(u,1);return p.splice(A,0,...h),p}),t.currentTarget.focus())},n.style.setProperty("touch-action","none"),$(n,()=>e.children),Z(()=>pe(n,e.class)),n})()}Te(["keydown","pointerdown"]);let _e=0;function rn(){_e++,_e===1&&(window.onbeforeunload=function(e){return"You have unsaved changes."})}function sn(){_e-=1,_e===0&&(window.onbeforeunload=()=>{})}function on(){return rn(),ge(()=>{sn()}),[]}function an(e){function r(a,f){e.applyAction(a.current_state,f),e.displayAction?.(a,f),a.redo_history=[]}function n(a,f){e.undoAction(a.current_state,f),e.displayAction?.(a,f)}function t(a){return a.history.length>0||e.hasPreview(a)}function u(a){if(e.hasPreview(a)){const f=a.redo_history;a.redo_history.length!==0&&(a.redo_history=[]);const C=a.history.length;return e.commitPreview(a),a.history.length!==C?"pushed_actions":(a.redo_history=f,"undid_actions")}return"no_preview"}function _(a){if(u(a)!=="undid_actions")for(;;){const f=a.history.pop();if(f==null)return;e.undoAction(a.current_state,f),e.displayAction?.(a,f),a.redo_history.push(f);const C=a.history[a.history.length-1];if(!(C!=null&&e.groupActionWithNext?.(C)))break}}function A(a){return a.redo_history.length>0&&!e.hasPreview(a)}function p(a){if(!e.hasPreview(a))for(;;){const f=a.redo_history.pop();if(f==null)return;if(e.applyAction(a.current_state,f),e.displayAction?.(a,f),a.history.push(f),!e.groupActionWithNext?.(f))break}}function h(a,f){if(e.hasPreview(a))throw new Error("must execCommitProgress before execAndSaveActions");e.applyAction(a.current_state,f),e.displayAction?.(a,f),a.history.push(f),a.redo_history=[]}function x(a,f){e.hasPreview(a)&&e.commitPreview(a),a.current_state=f,a.history=[],a.redo_history=[]}return{execCommitProgress:u,execNoSaveAction:r,execNoSaveUnapplyAction:n,checkUndoAvailable:t,execUndo:_,checkRedoAvailable:A,execRedo:p,execAndSaveAction:h,execClearAll:x,checkHasPreview:e.hasPreview}}var Ne=B('<div class="w-full h-full">'),We=B('<div class="w-full h-full flex items-center justify-center">'),ln=B('<svg class="w-full h-full"viewBox="-20 -20 140 140"fill=none xmlns=http://www.w3.org/2000/svg><circle r=24 fill=#2955F4></circle><path stroke-width=12 stroke=#2955F4 stroke-linecap=round stroke-linejoin=round>'),cn=B('<svg class="w-full h-full"viewBox="-20 -20 140 140"fill=none xmlns=http://www.w3.org/2000/svg><circle r=12 fill=#2955F4>'),un=B("<svg><path stroke-width=6 stroke=#2955F4 stroke-linecap=round stroke-linejoin=round></svg>",!1,!0),dn=B("<div class=pb-2>"),pn=B('<div class="h-80 overflow-x-clip overflow-y-auto border-y border-ui-bg-300 transition-colors duration-100"><div class="grid grid-flow-row grid-cols-4 gap-x-4 gap-y-4">'),fn=B("<div>"),_n=B("<div class=w-[0.875rem]>"),hn=B('<button class="flex flex-col relative"><div class="w-full aspect-square ring-1 ring-ui-bg-300 peer-focus-visible:outline outline-2 outline-ui-hl-600 outline-offset-2 ring-inset ui-checked:ring-2 ui-checked:ring-ui-hl-600 rounded">'),Ie=B('<div class="flex flex-row gap-4"><div class="flex-1 flex flex-col">'),gn=B('<div class="flex flex-wrap items-center">Total duration: <!> sec <button>'),vn=B('<button class="flex flex-row gap-2 text-[#3451b2] items-center"><span>Add pause'),mn=B('<div class="flex flex-row gap-1 items-center"><div class="aspect-square w-7">'),xn=B('<div class="w-22 my-1 h-8">'),bn=B("<div class=flex-1>");const oe={duration:1};function le(e,r){const n=e.current_state.shapeset_value.shapes;Object.hasOwn(n,r)||E.execAndSaveAction(e,{kind:"update_pattern",pattern:r,old_pattern:null,new_pattern:{strokes:[]}})}function ie(e,r){E.execAndSaveAction(e,{kind:"undo_point"})}function wn(e,r){le(e,r);const t=e.current_state.shapeset_value.shapes[r];E.execAndSaveAction(e,{kind:"update_pattern",old_pattern:t,new_pattern:{strokes:[]},pattern:r}),ie(e)}function he(e,r,n){le(e,r);const u=e.current_state.shapeset_value.shapes[r];E.execAndSaveAction(e,{kind:"update_pattern",old_pattern:u,new_pattern:{strokes:[...u.strokes,...n]},pattern:r}),ie(e)}function ne(e,r,n){le(e,r);const u=e.current_state.shapeset_value.shapes[r];E.execAndSaveAction(e,{kind:"update_pattern",old_pattern:u,new_pattern:{strokes:n},pattern:r}),ie(e)}function yn(e,r){const t=e.current_state.shapeset_value.shapes[r];E.execAndSaveAction(e,{kind:"update_pattern",pattern:r,old_pattern:t,new_pattern:null}),ie(e)}const E=an({applyAction(e,r){if(e==null)throw new Error("vs == null");if(r.kind==="update_pattern")r.new_pattern==null?delete e.shapeset_value.shapes[r.pattern]:e.shapeset_value.shapes[r.pattern]=r.new_pattern;else if(r.kind!=="undo_point")throw new Error("todo impl applyAction "+r)},undoAction(e,r){if(e==null)throw new Error("vs == null");if(r.kind==="update_pattern")r.old_pattern==null?delete e.shapeset_value.shapes[r.pattern]:e.shapeset_value.shapes[r.pattern]=r.old_pattern;else if(r.kind!=="undo_point")throw new Error("todo impl undoAction "+r)},displayAction(e,r){r.kind!=="undo_point"&&e.shape!==r.pattern&&(e.shape=r.pattern)},hasPreview(e){return e.next_pattern!=null&&e.next_pattern.points.length>1||e.next_drag!=null||e.pencil_line!=null},commitPreview(e){const r=e.next_drag;e.next_drag=void 0,r!=null&&(e.history.push(r),ie(e,r.pattern));const n=e.pencil_line;if(e.pencil_line=void 0,n!=null)if(n.length===1)he(e,e.shape,[{...oe,points:[{pos:n[0],prev_control_offset:[0,0],next_control_offset:[0,0]}]}]);else{const t=[500,500],_=Ht(n.map(x=>I.mul(x,t)),10),A=[],p=_[_.length-1];p!=null&&_.push([p[3],p[3],[0,0],[0,0]]);const h=_[0];h!=null&&_.unshift([[0,0],[0,0],h[0],h[0]]);for(let x=1;x<_.length;x++){const[a,f]=_[x],[C,D,b,l]=_[x-1],w=I.div(a,t);A.push({pos:w,prev_control_offset:I.sub(I.div(b,t),w),next_control_offset:I.sub(I.div(f,t),w)})}A.length>0&&he(e,e.shape,[{...oe,points:A}])}e.next_pattern=void 0},groupActionWithNext(e){return e.kind!=="undo_point"}});function Ye(e,r){const n=e.current_state.shapeset_value.shapes[r]??void 0,t=e.saved_patterns.get(r)??void 0;return n!==t}function Q(e){return E.checkHasPreview(e)||Object.keys(e.current_state.shapeset_value.shapes).some(r=>Ye(e,r))}function Ve(e,r){let n=[];const t=(h,x)=>h+x.map(a=>a.toFixed(0)).join(",");function u(h){const x=I.div(I.sub(h,_[0]),_[1]);return I.add(A[0],I.mul(x,A[1]))}let _=[[0,0],[1,1]],A=[[0,0],[100,100]];if(r?.fullsize){let h=[1/0,1/0],x=[-1/0,-1/0];for(const C of e.points)h=I.min(C.pos,h),x=I.max(C.pos,x);const a=I.sub(x,h),f=Ut([[0,0],[100,100]],a[0]/a[1]);_=[h,[a[0]||1,a[1]||1]],A=f}let p=null;for(const[h,x]of e.points.entries())if(h===0)p=u(x.pos),n.push(t("M",[...u(x.pos)])),n.push(t("l",[0,0]));else{const a=e.points[h-1],f=I.add(a.pos,a.next_control_offset),C=I.add(x.pos,x.prev_control_offset);n.push(t("C",[...u(f),...u(C),...u(x.pos)]))}return{d:n.join(" "),first_pt:p}}function An(e){const r=R(()=>e.stroke!=null?Ve(e.stroke,{fullsize:!0}):null);return(()=>{var n=Ne();return $(n,(()=>{var t=R(()=>e.stroke.points.length===0);return()=>t()?(()=>{var u=We();return $(u,y(X,{tag:"pause",class:"text-xl text-ui-bg-400",label:"Delay"})),u})():(()=>{var u=ln(),_=u.firstChild,A=_.nextSibling;return Z(p=>{var h=r()?.first_pt?.[0],x=r()?.first_pt?.[1],a=r()?.d;return h!==p.e&&ee(_,"cx",p.e=h),x!==p.t&&ee(_,"cy",p.t=x),a!==p.a&&ee(A,"d",p.a=a),p},{e:void 0,t:void 0,a:void 0}),u})()})()),n})()}function Le(e){return(()=>{var r=Ne();return $(r,(()=>{var n=R(()=>e.shape==null);return()=>n()?(()=>{var t=We();return $(t,y(X,{tag:"add",class:"text-xl text-ui-bg-400",label:"Create"})),t})():(()=>{var t=cn(),u=t.firstChild;return $(t,()=>e.shape.strokes.map(_=>(()=>{var A=un();return Z(()=>ee(A,"d",Ve(_).d)),A})()),null),Z(_=>{var A=(e.shape.strokes[0]?.points[0]?.pos[0]??-100)*100,p=(e.shape.strokes[0]?.points[0]?.pos[1]??-100)*100;return A!==_.e&&ee(u,"cx",_.e=A),p!==_.t&&ee(u,"cy",_.t=p),_},{e:void 0,t:void 0}),t})()})()),r})()}function Cn(){const{state:e,setState:r}=G(se),n=()=>e().modes.define_symbols,t=R(()=>{const _=n().current_state;return _.shapeset_tag!=null?V(_.shapeset_tag).tag:"other"}),u=()=>{const _=n().current_state;return _.shapeset_tag!=null&&V(_.shapeset_tag).tag,qe(t(),_.shapeset_value)};return y(Bt,{get value(){return n().shape},onChange:_=>{n().shape=_,r()},get children(){return[(()=>{var _=dn();return $(_,y(It,{children:"Patterns"})),_})(),(()=>{var _=pn(),A=_.firstChild;return de(p=>{function h(){p.scrollTop<=0?p.style.borderTopColor="transparent":p.style.borderTopColor="",p.scrollTop>=p.scrollHeight-p.clientHeight?p.style.borderBottomColor="transparent":p.style.borderBottomColor=""}p.addEventListener("scroll",()=>{h()},{passive:!0}),new ResizeObserver(h).observe(p),h()},_),$(A,y(Be,{get each(){return u()},children:p=>{const h=()=>n().current_state.shapeset_value,x=R(()=>p===n().shape);let[a,f]=J(void 0,{equals:!1});const C=R(()=>Object.hasOwn(h().shapes,p)?h().shapes[p]:null);re(()=>{if(x()){f(void 0);const s=setInterval(()=>f(void 0),1e3);ge(()=>clearInterval(s))}else f(void 0)});const D=R(()=>(a(),Ye(n(),p)||x()&&E.checkHasPreview(n()))),b=()=>C()!=null,[l,w]=J(!1);return y(Lt,{value:p,class:"flex flex-col relative",get children(){return[y(Dt,{class:"peer"}),y(Et,{class:"aspect-square ring-1 ring-ui-bg-300 peer-focus-visible:outline outline-2 outline-ui-hl-600 outline-offset-2 ring-inset ui-checked:ring-2 ui-checked:ring-ui-hl-600 rounded",get children(){return a(),y(Le,{get shape(){return C()}})}}),y($t,{class:"flex flex-row items-center p-1",get children(){return[R(()=>R(()=>!!b())()?_n():null),(()=>{var s=fn();return $(s,(()=>{var d=R(()=>t()==="objd");return()=>d()?Mt[p.startsWith("obj_")?p.substring(4):p]??p:p})(),null),$(s,()=>D()?"*":null,null),Z(()=>pe(s,"flex-1 text-center "+(D()?"text-red-600 font-bold":""))),s})(),R(()=>R(()=>!!b())()?y(Rt,{get open(){return l()},onOpenChange:s=>w(s),get children(){return[y(Ot,{get children(){return y(X,{tag:"more_vert",class:"text-sm",label:"More"})}}),y(Fe,{get children(){return y(Tt,{class:"mt-1 dropdown-menu__content-animations max-h-[var(--kb-popper-content-available-height)] overflow-y-auto min-w-[220px] p-2 bg-white rounded border border-ui-bg-300 shadow outline-none origin-[var(--kb-menu-content-transform-origin)] flex flex-col gap-2",get children(){return[y(be,{class:we,onSelect:()=>(async()=>{r();const s=p,d=await ae(xe({title:"Rename Shape",label:"Name",placeholder:"my pattern",default_value:s,action_label:"Rename"}));if(d==null)return;if(Object.hasOwn(n().current_state.shapeset_value.shapes,d))throw new Error("Shape named `"+d+"` already exists.");const o=n().current_state.shapeset_value.shapes[s];if(o==null)throw new Error("attempt to rename non-existent shape");const i=n().shape;E.execAndSaveAction(n(),{kind:"update_pattern",pattern:d,old_pattern:null,new_pattern:o}),E.execAndSaveAction(n(),{kind:"update_pattern",pattern:s,old_pattern:o,new_pattern:null}),E.execAndSaveAction(n(),{kind:"undo_point"}),n().shape=i,n().shape===s&&(alert("updsel: "+n().shape+", "+s+", "+d),n().shape=d),r()})().catch(K),get children(){return[y(X,{class:"text-xl",tag:"edit",label:"Rename"}),"Rename"]}}),y(be,{class:we+" text-red-600",onSelect:()=>{yn(n(),p),r()},get children(){return[y(X,{class:"text-xl",tag:"delete",label:"Delete"}),"Delete"]}})]}})}})]}}):null)]}})]}})}}),null),$(A,(()=>{var p=R(()=>t()!=="objd");return()=>p()?(()=>{var h=hn(),x=h.firstChild;return h.$$click=()=>{(async()=>{const a=await ae(xe({title:"Shape Name",label:"Name",placeholder:"my pattern",action_label:"Create"}));a!=null&&(le(n(),a),E.execAndSaveAction(n(),{kind:"undo_point"}),n().shape=a,r())})().catch(K)},$(x,y(Le,{shape:null})),h})():null})(),null),_})()]}})}const Xe={name:"Pencil",hotkeys:["Shift+P"],callback(e,r){const n=e.modes.define_symbols;n.tool="pencil",r()}},He={name:"Pen",hotkeys:["P"],callback(e,r){const n=e.modes.define_symbols;n.tool="pen",r()}},Qe={name:"Select",hotkeys:["V"],callback(e,r){const n=e.modes.define_symbols;n.tool="move",r()}},De=ft((e,r)=>{const n=e.modes.define_symbols;E.execUndo(n),r()}),Ee=_t((e,r)=>{const n=e.modes.define_symbols;E.execRedo(n),r()}),kn={name:"End Pen Line",hotkeys:["Escape"],callback(e,r){const n=e.modes.define_symbols,t=n.next_pattern;t!=null&&n.shape!=null&&(t.points.length>1&&(E.execCommitProgress(n),he(n,n.shape,[t])),n.next_pattern=void 0)}};function Ge(e){return V(e.current_state.shapeset_tag??"").from!=="local"}const $e={name:"Save",hotkeys:["$mod+s"],callback(e,r){(async()=>{const n=e.modes.define_symbols;if(!Q(n))return;E.execCommitProgress(n);let t=n.current_state.shapeset_tag;if(Ge(n)||t==null){const _=t!=null?V(t).tag:"other";let A=await ae(xe({title:"Save As",label:"Patternset Name",placeholder:"My Patternset",action_label:"Save As"}));if(A==null)return;t=await ht(_,A)}n.current_state.shapeset_tag=t;const u=new Map(Object.entries(n.current_state.shapeset_value.shapes));r(),await gt(t,n.current_state.shapeset_value),n.saved_patterns=u,r()})().catch(K)}},Pn={move:{icon:"arrow_selector_tool",label:"Edit Curve",action:Qe},pen:{icon:"ink_pen",label:"Vector Pen",action:He},pencil:{icon:"stylus",label:"Freehand Pencil",action:Xe}},Ln={config:{supports_line_thickness:!0},actions:[Xe,He,Qe,De,Ee,kn,$e],backgroundPanel(){const{state:e,setState:r}=G(se),n=()=>e().modes.define_symbols;return R((()=>{var t=R(()=>!!Q(n()));return()=>t()?y(on,{}):null})())},sidePanel(e){const{state:r,setState:n}=G(se),t=()=>r().modes.define_symbols,u=()=>Ge(t()),_=()=>{const a=V(t().current_state.shapeset_tag??"").from;return a==="local"||a==="import"},A=R(()=>{const a=t().current_state.shapeset_value.shapes[t().shape]?.strokes;return a??[]}),p=R(()=>{const a=A();if(a==null)return 0;let f=0;for(const C of a)f+=C.duration??1;return f}),h=a=>{if(a==null){E.execClearAll(t(),{shapeset_tag:null,shapeset_value:{shapes:{}}}),t().shape="Default",t().saved_patterns=new Map,n();return}Ft(a).then(f=>{E.execClearAll(t(),{shapeset_tag:a,shapeset_value:f});const C=qe(V(a).tag,f);t().shape=C[0],t().saved_patterns=new Map(Object.entries(f.shapes)),n()}).catch(K)},x=a=>y(Fe,{get children(){return y(jt,{class:qt,get children(){return y(be,{class:we+" text-red-500",onClick:()=>{const f=[...t().current_state.shapeset_value.shapes[t().shape]?.strokes??[]],C=f.indexOf(a.item);C!=-1&&(f.splice(C,1),ne(t(),t().shape,f),n())},children:"Delete"})}})}});return[y(ke,{collapsible:"Define Symbols",get children(){return[y(xt,{get shapeset(){return t().current_state.shapeset_tag},setShapeset:a=>{h(a)},allowNew:!0,get disabled(){return Q(t())},noAutoSelect:!0}),[(()=>{var a=Ie(),f=a.firstChild;return $(f,y(me,{view:"destructive",get label(){return Q(t())?"Discard Changes":"Delete Patternset"},icon:"delete",onClick:()=>{(async()=>{if(Q(t())){if(!await ae(Ce({title:"Discard unsaved changes?",description:"This cannot be undone.",action_label:"Discard Changes"})))return;h(t().current_state.shapeset_tag)}else{const C=t().current_state.shapeset_tag;if(C==null)throw new Error("should not be possible");if(!await ae(Ce({title:"Delete patternset?",description:"This cannot be undone. Patternset: "+V(C).name,action_label:"Delete"})))return;await bt(C),h(null)}})().catch(K)},get disabled(){return R(()=>!Q(t()))()&&!_()}})),a})(),(()=>{var a=Ie(),f=a.firstChild;return $(f,y(me,{get label(){return u()?"Save As...":"Save"},icon:"save",onClick:()=>(async()=>{$e.callback(r(),n)})().catch(K),get disabled(){return!Q(t())}})),$(a,y(me,{label:"Export",hide_label:!0,icon:"download",onClick:()=>{const C=t().current_state.shapeset_tag;if(C==null)return K(new Error("shapeset tag is null"));const D=V(C),b=JSON.stringify({meta:{name:D.name,tag:D.tag},content:t().current_state.shapeset_value}),l=D.tag+"_"+D.name,w=URL.createObjectURL(new Blob([new TextEncoder().encode(b)])),s=document.createElement("a");s.style.display="none",s.href=w,s.download=l+".tapset",document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(w)}}),null),a})(),y(Cn,{})]]}}),y(ke,{collapsible:"Sequence",get children(){return[y(wt,{get when(){return A().length>0},get fallback(){return"No strokes"},get children(){return[(()=>{var a=gn(),f=a.firstChild,C=f.nextSibling,D=C.nextSibling,b=D.nextSibling;return $(a,()=>p().toFixed(2),C),b.$$click=()=>{const l=p(),w=prompt("Total duration",l.toFixed(2));if(w==null)return;const s=+w;if(!s||s<0)return;const d=s/l,o=[...t().current_state.shapeset_value.shapes[t().shape]?.strokes??[]];for(let i=0;i<o.length;i++){const c=o[i];o[i]={...c,duration:(c.duration??1)*d}}ne(t(),t().shape,o),n()},$(b,y(X,{class:"text-xl",tag:"edit",label:"Edit"})),a})(),y(tn,{get items(){return A()},setItems:a=>{const f=[...t().current_state.shapeset_value.shapes[t().shape]?.strokes??[]];ne(t(),t().shape,a(f)),n()},wrapper_class:"",nodeClass:a=>"",disable_clip_path:!0,children:(a,f,C,D)=>y(Yt,{get children(){return[y(Vt,{as:"div",get class(){return"flex flex-row gap-3 items-center h-10 pr-1 transition-all duration-100 rounded-md hover:bg-[#f4f4f4] "+(f()?"shadow-md ring-1 ring-figma-grey-200 bg-white ":"")},onmouseenter:()=>{t().hover_sequence_item=a,n()},onmouseleave:()=>{t().hover_sequence_item===a&&(t().hover_sequence_item=void 0,n())},get children(){return[(()=>{var b=mn(),l=b.firstChild;return $(b,y(nn,{class:"",get children(){return y(X,{label:"Drag",tag:"drag_handle",class:"text-md text-[#898989]"})}}),l),$(l,y(An,{stroke:a})),b})(),(()=>{var b=xn();return $(b,y(yt,{get value(){return a.duration??1},setValue:l=>{const w=[...t().current_state.shapeset_value.shapes[t().shape]?.strokes??[]],s=w.indexOf(a);s!=-1&&(w[s]={...w[s],duration:l},ne(t(),t().shape,w),n())},skip_set_value_on_input:!0,unit:"sec",min:0,max:2,step:.1,decimals:2})),b})(),(()=>{var b=bn();return $(b,(()=>{var l=R(()=>a.points.length!==0);return()=>l()?y(At,{get value(){return a.easing_function??null},setValue:w=>{const s=[...t().current_state.shapeset_value.shapes[t().shape]?.strokes??[]],d=s.indexOf(a);d!=-1&&(s[d]={...s[d],easing_function:w==="ease_in"?"ease_in":w==="ease_out"?"ease_out":w==="ease_in_out"?"ease_in_out":void 0},ne(t(),t().shape,s),n())},noAutoSelect:!0,choices:[["ease_in","Ease In"],["ease_out","Ease Out"],["ease_in_out","Ease In Out"]],names:{none:"Linear",empty_list:"*EMPTY_LIST*"}}):null})()),b})()]}}),y(x,{item:a})]}})})]}}),(()=>{var a=vn(),f=a.firstChild;return a.$$click=()=>{he(t(),t().shape,[{...oe,points:[]}]),n()},$(a,y(X,{label:"Add",tag:"add",class:"text-xl"}),f),a})(),y(Ct,{})]}})]},toolsPanel(){const{state:e,setState:r}=G(se),n=()=>e().modes.define_symbols;return y(it,{tools_cfg:Pn,get value(){const t=n().tool;if(t!=="define_rect")return t},setValue:t=>{n().tool=t,r()}})},dockPanel(){const{state:e,setState:r}=G(se),n=()=>e().modes.define_symbols;let t;return[y(Pe,{vertical:!0,get children(){return[y(kt,{undo:De,get undo_available(){return E.checkUndoAvailable(n())},redo:Ee,get redo_available(){return E.checkRedoAvailable(n())}}),y(Pt,{icon:"delete",label:"Clear",onClick:()=>{const u=n();E.execCommitProgress(u),u.shape!=null&&wn(u,u.shape),r()}})]}}),y(Pe,{vertical:!0,get children(){return y(St,{get dr_tools_active(){return n().tool==="define_rect"},setDrToolsActive:u=>{if(u){const _=n().tool;_!=="define_rect"&&(t=_),n().tool="define_rect"}else n().tool=t??"pencil";r()}})}})]},render({state:e,imev:r,frame:n}){const{ctx:t}=r,u=e.modes.define_symbols;u.tool!=="pen"&&(u.next_pattern=void 0);const _=ct(e,n,r,{enable_resize:u.tool==="define_rect",show_inner_preview:!0,show_preview:!0});if(u.shape==null)return;const A=u.shape,p=u.current_state.shapeset_value.shapes,h=Object.hasOwn(p,A)?p[A]:{strokes:[]},x=l=>{const w=H(n,l);return ue(e.define_rect,n,w)},a={...oe,points:[...u.next_pattern?.points??[]]};let f=null;u.tool==="pen"?r.mouse.pos!=null&&(f={pos:x(r.mouse.pos),prev_control_offset:[0,0],next_control_offset:[0,0]},a.points.push(f)):u.next_pattern=void 0;const C=[...h.strokes,...a.points.length>0?[a]:[]];function D(l,w,s,d){const o=4/n.scale,i=s==="pos"?l.pos:I.add(l.pos,l[s]);t.strokeStyle="#5AABF5",t.fillStyle=mt,d?.fill&&(t.fillStyle=t.strokeStyle),t.lineWidth=2/n.scale;const[c,v]=_(i);t.beginPath(),s==="pos"?t.arc(c,v,o,0,2*Math.PI):(t.moveTo(c,v-o),t.lineTo(c+o,v),t.lineTo(c,v+o),t.lineTo(c-o,v),t.closePath()),t.fill(),t.stroke(),r.mouse.pos!=null&&w!=null&&Math.hypot(...I.sub([c,v],H(n,r.mouse.pos)))<=o*2&&(r.mouse.action={cursor:"grab",callback:(m,k)=>{le(u,A);const P=H(n,m),L=F=>{let[j,q]=F;return ue(e.define_rect,n,[j,q])},S=u.current_state.shapeset_value.shapes[A];if(S==null)return{onmove(){},onrelease(){}};function O(F){u.next_drag!=null&&E.execNoSaveUnapplyAction(u,u.next_drag),u.next_drag={kind:"update_pattern",pattern:A,old_pattern:S,new_pattern:F},u.next_drag!=null&&E.execNoSaveAction(u,u.next_drag)}const T=l[s],Y=L(P);O(S);const M=F=>{const j=L(F),q=I.sub(j,Y);O({strokes:S.strokes.map((U,N)=>N!==w.pt_stroke?U:{...U,points:U.points.map((z,ve)=>ve!==w.pt_point?z:{...z,[s]:I.add(T,q)})})})};return k.setstate(),{onmove(F){M(H(n,F)),k.setstate()},onrelease(F){M(H(n,F)),E.execCommitProgress(u),k.setstate()}}}})}function b(l,w,s){t.strokeStyle=vt,t.lineWidth=1/n.scale,t.moveTo(..._(I.add(l.pos,l.prev_control_offset))),t.lineTo(..._(l.pos)),t.lineTo(..._(I.add(l.pos,l.next_control_offset))),t.stroke(),D(l,w,"pos",s),I.eql(l.next_control_offset,[0,0])||D(l,w,"next_control_offset"),I.eql(l.prev_control_offset,[0,0])||D(l,w,"prev_control_offset")}if(zt(t,e,n,C,e.define_rect,{hover_sequence_item:u.hover_sequence_item,next_pattern:a,mouse_point:f}),t.strokeStyle="black",t.lineWidth=2/n.scale,t.beginPath(),u.tool==="move"&&u.next_pattern==null)for(const[l,w]of h.strokes.entries())for(const[s,d]of w.points.entries())b(d,{pt_stroke:l,pt_point:s});else if(u.tool==="pen"&&a.points.length>0){const l=u.next_pattern?.points??[];f!=null&&b(f,null);for(const[w,s]of l.entries()){let d=w===l.length-1;b(s,null,{fill:d})}}else if(u.tool==="pencil"){t.beginPath();const l=u.pencil_line?.[0];if(l!=null){t.moveTo(..._(l));for(let w=1;w<u.pencil_line.length;w++){const s=_(u.pencil_line[w]);t.lineTo(s[0],s[1])}t.stroke()}}u.tool==="pencil"&&(r.mouse.action={cursor:"default",callback:(l,w)=>{const s=e.modes.define_symbols,d=i=>{let[c,v]=H(n,i);return ue(e.define_rect,n,[c,v])},o=i=>{const c=d(i);s.pencil_line??=[];const v=s.pencil_line[s.pencil_line.length-1];v!=null&&I.eql(v,c)||s.pencil_line.push(c)};return s.pencil_line=[],o(l),{onmove(i){o(i)},onrelease(i){o(i),E.execCommitProgress(s),w.setstate()}}}}),u.tool==="pen"&&(r.mouse.action={cursor:"url("+Gt+"), url("+Qt+"), auto",callback:(l,w)=>{const s=e.modes.define_symbols,d=L=>{let[S,O]=H(n,L);return ue(e.define_rect,n,[S,O])},[o,i]=d(l);s.next_pattern??={...oe,points:[]};const c=s.next_pattern,v={pos:[o,i],next_control_offset:[0,0],prev_control_offset:[0,0]};c.points.push(v);const g=[o,i];let m=!1;const k=L=>{v.next_control_offset=I.sub(L,g),v.prev_control_offset=I.sub([0,0],v.next_control_offset)},P=l;return{onmove(L){if(I.distance(P,L)>20&&(m=!0),m){const[S,O]=d(L);k([S,O])}},onrelease(L){const[S,O]=d(L);k([S,O]),w.setstate()}}}})},previewer(e){const r=e.modes.define_symbols;if(r.shape==null)return[];const n=r.shape,t=r.current_state.shapeset_value.shapes,u=Object.hasOwn(t,n)?t[n]:{strokes:[]};return ut(e,[...u.strokes,...r.next_pattern!=null?[r.next_pattern]:[]],dt(e.define_rect,{grid:pt(e)}))},skip_wait_seq_displayed_on_preview:!0};Te(["click"]);export{Ln as default};
